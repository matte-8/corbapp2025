<!doctype html>
<html lang="it"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Prossima partita - CORB</title>
<link rel="manifest" href="manifest.json"><meta name="theme-color" content="#6b0f1a">
<link rel="apple-touch-icon" href="img/icons/icon-192.png"><meta name="apple-mobile-web-app-capable" content="yes">
<link rel="stylesheet" href="./style.css?v=22"></head>
<body>
<header class="topbar"><div class="nav"><a href="./index.html" style="color:#fff">â†</a><div class="title">Prossima partita</div></div>
<div class="right"><button id="menuBtn" class="iconbtn" aria-label="Menu" title="Menu"><svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round"><path d="M3 6h18M3 12h18M3 18h18"/></svg></button></div></header>
<nav id="drawer"><span id="drawer-close">âœ•</span><h3>Menu</h3>
<a href="./news.html">ğŸ“° News</a><a href="./squadra.html">ğŸ‘¥ Squadra</a><a href="./video.html">ğŸ¥ Video</a>
<a href="./prossima.html">ğŸ“… Prossima partita</a><a href="./partite.html">ğŸ† Risultati</a><a href="./calendario.html">ğŸ“† Calendario</a><a href="./admin.html">âš™ï¸ Admin</a></nav>
<script>(function(){const d=document,dr=d.getElementById('drawer'),b=d.getElementById('menuBtn'),x=d.getElementById('drawer-close');b&&b.addEventListener('click',e=>{e.stopPropagation();dr.classList.add('open')});x&&x.addEventListener('click',()=>dr.classList.remove('open'));d.addEventListener('click',e=>{if(dr.classList.contains('open')&&!dr.contains(e.target)&&e.target!==b)dr.classList.remove('open')});})();</script>

<main class="container">
  <section class="card" id="nextBox"><div class="small">Caricamentoâ€¦</div></section>
  <section class="card"><h2 style="margin:0 0 8px 0">Prossime partite</h2><div id="futureList"></div></section>
</main>

<script type="module">
  import {get} from './data-store.js';
  const CORB = 'img/logo_c5.png', AVV='img/logo_avv.png';
  const matches = (get('partite')||[]).map(m=>({
    ...m, date:new Date((m.data||'')+'T'+(m.ora||'00:00'))
  })).filter(m=>!isNaN(+m.date)).sort((a,b)=>a.date-b.date);
  const now=new Date();
  const future = matches.filter(m=>m.date>now);
  const next = future[0];

  const teamLogo = (m, side)=>{
    const isHome = (m.casa||'').trim().toLowerCase()==='corbiolo';
    if (side==='left'){
      const name = isHome ? 'corbiolo' : (m.casa||'').toLowerCase();
      if (name==='corbiolo') return CORB;
      return m.logocasa || m.logo_casa || AVV;
    } else {
      const name = isHome ? (m.fuori||'').toLowerCase() : 'corbiolo';
      if (name==='corbiolo') return CORB;
      return m.logoavv || m.logo_fuori || AVV;
    }
  };

  const isHome = m => (m.casa||'').trim().toLowerCase()==='corbiolo';
  const formatDate = d => d.toLocaleDateString(undefined,{weekday:'long', day:'2-digit', month:'long'}) + ' Â· ' + d.toLocaleTimeString(undefined,{hour:'2-digit',minute:'2-digit'});

  const nextBox = document.getElementById('nextBox');
  if (!next){ nextBox.innerHTML = '<div class="small">Nessuna partita in programma</div>'; }
  else{
    const left  = isHome(next) ? 'Corbiolo' : (next.casa||'');
    const right = isHome(next) ? (next.fuori||'') : 'Corbiolo';
    nextBox.innerHTML = `
      <div class="card" style="background:linear-gradient(180deg,var(--granata),var(--granata-2));color:#fff;border:none">
        <div class="row" style="justify-content:space-between;align-items:center">
          <div class="row">
            <span class="team-badge"><img src="${teamLogo(next,'left')}" alt=""></span>
            <strong>${left}</strong>
          </div>
          <div class="pill" style="background:rgba(255,255,255,.15);border-color:rgba(255,255,255,.25);color:#fff">VS</div>
          <div class="row">
            <strong>${right}</strong>
            <span class="team-badge"><img src="${teamLogo(next,'right')}" alt=""></span>
          </div>
        </div>
        <div class="small" style="margin-top:10px">ğŸ“… ${formatDate(next.date)} Â· ${isHome(next)?'ğŸ  Casa':'âœˆï¸ Trasferta'}</div>
      </div>
    `;
  }

  const list = document.getElementById('futureList');
  list.innerHTML = future.map(m=>{
    const homeSide = isHome(m);
    const s1 = homeSide? 'Corbiolo' : (m.casa||'Avversario');
    const s2 = homeSide? (m.fuori||'Avversario') : 'Corbiolo';
    const icon = homeSide?'ğŸ ':'âœˆï¸';
    const ds = m.date.toLocaleDateString(undefined,{weekday:'short', day:'2-digit', month:'short'}) + ', ' +
               m.date.toLocaleTimeString(undefined,{hour:'2-digit',minute:'2-digit'});
    return `<div class="future-row">
      <div class="row">
        <span class="pill ${homeSide?'home-pill':'away-pill'}">${icon}</span>
        <span class="team-badge"><img src="${teamLogo(m,'left')}" alt=""></span>
        <strong>${s1}</strong><span class="muted">-</span><strong>${s2}</strong>
        <span class="team-badge"><img src="${teamLogo(m,'right')}" alt=""></span>
      </div>
      <div class="small">${ds}</div>
    </div>`;
  }).join('') || '<div class="small">Nessuna partita</div>';

  if ('serviceWorker' in navigator) navigator.serviceWorker.register('./sw.js');
</script>
</body></html>
