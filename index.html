<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Home - CORB</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#6b0f1a">
  <link rel="apple-touch-icon" href="img/logo_c5.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="stylesheet" href="./style.css?v=33">

  <style>
    /* sfondo morbido */
    .soft-bg{position:fixed;inset:0;z-index:0;
      background:linear-gradient(180deg,#efe1e5 0%, #f3e8eb 45%, #f7f5f6 85%, #ffffff 100%)}

    /* griglia 6 box */
    .grid-home{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    @media(min-width:720px){.grid-home{grid-template-columns:repeat(3,1fr)}}
    .home-box{display:flex;flex-direction:column;align-items:center;justify-content:center;
      min-height:118px;border-radius:18px;background:var(--granata);color:#fff;
      box-shadow:0 6px 20px rgba(0,0,0,.15);font-weight:600;text-align:center}
    .home-emoji{font-size:28px;margin-bottom:8px;line-height:1}

    /* pannelli granata */
    .panel-granata{background:var(--granata);color:#fff;border-radius:18px;padding:16px;
      box-shadow:0 10px 30px rgba(0,0,0,.12)}

    /* ultima partita con loghi */
    .match-wrap{display:grid;grid-template-columns:1fr auto 1fr;gap:12px;align-items:center}
    .team{display:flex;align-items:center;gap:10px;min-width:0}
    .team.right{justify-content:flex-end}
    .team img{width:42px;height:42px;border-radius:10px;object-fit:contain;background:#fff;border:1px solid var(--ring)}
    .team .name{font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:140px}
    .score-big{display:flex;align-items:center;justify-content:center;width:72px;height:72px;
      border-radius:14px;background:#ffffff22;font-weight:800;font-size:24px;color:#fff}

    /* news preview: senza pill e con testo chiaro */
    .news-mini .item{display:block;padding:12px 0;border-bottom:1px solid #ffffff22}
    .news-mini .item:last-child{border-bottom:0}
    .news-mini .title{font-weight:800;color:#fff}
    .news-mini .excerpt{color:#f3f3f3;opacity:.95}
    .ellipsis{-webkit-line-clamp:2;display:-webkit-box;-webkit-box-orient:vertical;overflow:hidden}

    /* drawer inline (come sulle altre pagine) */
    #drawer{position:fixed;top:0;right:-260px;width:240px;height:100%;background:#fff;
      box-shadow:-3px 0 12px rgba(0,0,0,.2);transition:.3s;padding:20px;z-index:50;pointer-events:none}
    #drawer.open{right:0;pointer-events:auto}
    #drawer a{display:block;padding:12px 0;border-bottom:1px solid var(--ring);color:var(--text)}
    #drawer-close{position:absolute;top:12px;right:12px;font-size:20px;cursor:pointer}
  </style>
</head>
<body>
  <div class="soft-bg"></div>

  <!-- Topbar -->
  <header class="topbar">
    <div class="nav">
      <a href="./index.html" class="brand">
        <img src="img/logo_c5.png" alt="Corbiolo" class="brand-logo">
        <span class="title">Home</span>
      </a>
    </div>
    <div class="right">
      <button id="menuBtn" class="iconbtn" aria-label="Menu" title="Menu">
        <svg width="26" height="26" viewBox="0 0 24 24" fill="none"
             stroke="#ffffff" stroke-width="2" stroke-linecap="round">
          <path d="M3 6h18M3 12h18M3 18h18"/>
        </svg>
      </button>
    </div>
  </header>

  <!-- Drawer -->
  <nav id="drawer">
    <span id="drawer-close">âœ•</span>
    <h3>Menu</h3>
    <a href="./index.html">ğŸ  Home</a>
    <a href="./news.html">ğŸ“° News</a>
    <a href="./squadra.html">ğŸ‘¥ Squadra</a>
    <a href="./video.html">ğŸ¥ Video</a>
    <a href="./prossima.html">ğŸ“… Prossima partita</a>
    <a href="./partite.html">ğŸ† Risultati</a>
    <a href="./calendario.html">ğŸ“† Calendario</a>
    <a href="./admin.html">âš™ï¸ Admin</a>
  </nav>

  <main class="container" style="position:relative;z-index:1">
    <!-- 6 box -->
    <section class="grid-home">
      <a class="home-box" href="./news.html"><span class="home-emoji">ğŸ“°</span><div>News</div></a>
      <a class="home-box" href="./squadra.html"><span class="home-emoji">ğŸ‘¥</span><div>Squadra</div></a>
      <a class="home-box" href="./video.html"><span class="home-emoji">ğŸ¥</span><div>Video</div></a>
      <a class="home-box" href="./prossima.html"><span class="home-emoji">ğŸ“…</span><div>Prossima Partita</div></a>
      <a class="home-box" href="./partite.html"><span class="home-emoji">ğŸ†</span><div>Risultati</div></a>
      <a class="home-box" href="./calendario.html"><span class="home-emoji">ğŸ“†</span><div>Calendario</div></a>
    </section>

    <!-- Ultima partita -->
    <section class="panel-granata" style="margin-top:14px">
      <div class="row" style="justify-content:space-between">
        <h2 style="margin:0">Ultima partita</h2>
        <a class="pill" href="./partite.html">Vedi risultati</a>
      </div>
      <div id="lastMatch" class="match-wrap" style="margin-top:8px"></div>
    </section>

    <!-- Ultime news -->
    <section class="panel-granata" style="margin-top:14px">
      <div class="row" style="justify-content:space-between">
        <h2 style="margin:0">Ultime News</h2>
        <a class="pill" href="./news.html">Vedi tutte</a>
      </div>
      <div id="newsPreview" class="news-mini"></div>
    </section>

    <!-- Social -->
    <section class="card" style="display:flex;flex-direction:column;gap:12px;margin-top:14px">
      <h2 style="margin:0">Seguici sui social</h2>
      <div class="row" style="gap:10px;flex-wrap:wrap">
        <a class="pill" href="https://www.instagram.com/corbioloc5/" target="_blank" rel="noopener">Instagram</a>
        <a class="pill" href="https://www.facebook.com/uscorbiolo/?locale=it_IT" target="_blank" rel="noopener">Facebook</a>
        <a class="pill" href="https://www.uscorbiolo.it/" target="_blank" rel="noopener">Sito ufficiale</a>
      </div>
    </section>

    <!-- Ultimo sync -->
    <section class="card small" style="margin-top:14px">
      Ultimo aggiornamento dati: <span id="ls">never</span>
    </section>
  </main>

  <script type="module">
    import {last, get} from './data-store.js';

    // Drawer
    const drawer = document.getElementById('drawer');
    const openBtn = document.getElementById('menuBtn');
    const closeBtn = document.getElementById('drawer-close');
    openBtn.onclick = (e)=>{e.stopPropagation();drawer.classList.add('open')};
    closeBtn.onclick = ()=> drawer.classList.remove('open');
    document.addEventListener('click',(e)=>{ if(drawer.classList.contains('open') && !drawer.contains(e.target)) drawer.classList.remove('open'); });

    // Ultimo sync
    document.getElementById('ls').textContent = last();

    // ===== Ultima partita con loghi =====
    const matches = (get('matches')||[]).map(m=>({
      ...m,
      date: new Date((m.data||'')+'T'+(m.ora||'00:00'))
    })).filter(m=>!isNaN(+m.date));

    const now = new Date();
    const lastPlayed = matches
      .filter(m => m.date <= now)
      .sort((a,b)=> b.date - a.date)[0] || matches.sort((a,b)=> b.date - a.date)[0];

    const logoFor = (name, explicit) => {
      if (explicit && explicit.trim()) return explicit;
      if ((name||'').toLowerCase().includes('corbiolo')) return 'img/logo_c5.png';
      return 'img/logo_avv.png';
    };

    const lastBox = document.getElementById('lastMatch');
    if (lastPlayed){
      const homeName  = lastPlayed.casa  || 'Corbiolo';
      const awayName  = lastPlayed.fuori || 'Avversario';
      const homeLogo  = logoFor(homeName, lastPlayed.logo_casa);
      const awayLogo  = logoFor(awayName, lastPlayed.logo_fuori);
      const scoreText = (lastPlayed.risultato || 'â€“').replace('-', ' - ');

      lastBox.innerHTML = `
        <div class="team">
          <img src="${homeLogo}" alt="" onerror="this.src='img/logo_c5.png'">
          <div class="name">${homeName}</div>
        </div>
        <div class="score-big">${scoreText}</div>
        <div class="team right">
          <div class="name">${awayName}</div>
          <img src="${awayLogo}" alt="" onerror="this.src='img/logo_avv.png'">
        </div>`;
    } else {
      lastBox.innerHTML = `<div class="small">Nessuna partita disponibile</div>`;
    }

    // ===== Ultime 2 news: testo chiaro e senza pill laterale =====
    const news = (get('news')||[])
      .map(n=>({titolo:n.titolo||'', contenuto:n.contenuto||''}))
      .slice(-2).reverse();

    const wrap = document.getElementById('newsPreview');
    wrap.innerHTML = news.length
      ? news.map(n=>`
          <a class="item" href="./news.html">
            <div class="title">${n.titolo}</div>
            <div class="excerpt ellipsis small">${n.contenuto}</div>
          </a>`).join('')
      : '<div class="small" style="color:#f3f3f3">Nessuna notizia disponibile</div>';

    if ('serviceWorker' in navigator) navigator.serviceWorker.register('./sw.js');
  </script>
</body>
</html>
