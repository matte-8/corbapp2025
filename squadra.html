<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Squadra - CORB</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#6b0f1a">
  <link rel="apple-touch-icon" href="img/icons/icon-192.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="stylesheet" href="./style.css">
</head>

  <body>
 <!-- Topbar -->
<header class="topbar">
  <div class="nav">
    <a href="./index.html" class="brand">
      <img src="img/logo_c5.png" alt="Corbiolo" class="brand-logo">
      <span class="title">Squadra</span>
    </a>
  </div>
  <div class="right">
    <button data-role="menu-btn" class="iconbtn" aria-label="Menu" title="Menu">
      <!-- hamburger (solo 3 linee) -->
      <svg width="26" height="26" viewBox="0 0 24 24" fill="none"
           stroke="#ffffff" stroke-width="2" stroke-linecap="round">
        <path d="M3 6h18M3 12h18M3 18h18"/>
      </svg>
    </button>
  </div>
</header>

<!-- Drawer menu (uguale per tutte le pagine) -->
<nav class="drawer" data-role="drawer">
  <button class="drawer-close" data-role="drawer-close" aria-label="Chiudi">âœ•</button>
  <h3>Menu</h3>
  <a href="./index.html">ğŸ  Home</a>
  <a href="./news.html">ğŸ“° News</a>
  <a href="./squadra.html">ğŸ‘¥ Squadra</a>
  <a href="./video.html">ğŸ¥ Video</a>
  <a href="./prossima.html">ğŸ“… Prossima partita</a>
  <a href="./partite.html">ğŸ† Risultati</a>
  <a href="./calendario.html">ğŸ“† Calendario</a>
  <a href="./admin.html">âš™ï¸ Admin</a>
</nav>


  <main class="container">
    <!-- Search + filtri -->
    <section class="card">
      <div class="search">
        <span>ğŸ”</span>
        <input id="q" placeholder="Cerca giocatore per nome o numeroâ€¦">
      </div>
      <div class="chips" id="roles" style="margin-top:10px">
        <span class="chip active" data-role="">Tutti</span>
        <span class="chip" data-role="Portiere">Portieri</span>
        <span class="chip" data-role="Difensore">Difensori</span>
        <span class="chip" data-role="Centrale">Centrali</span>
        <span class="chip" data-role="Pivot">Pivot</span>
      </div>
    </section>

    <!-- Lista giocatori -->
    <section id="players"></section>
  </main>

  <script type="module">
    import {get} from './data-store.js';

    // Dalla cache (aggiornata via admin.html)
    const roster = (get('players') || [])
      .map(p => ({
        nome: p.nome || '',
        numero: p.numero || '',
        ruolo: p.ruolo || '',
        foto: p.foto || ''
      }))
      // Ordina per numero (se numerico), poi per nome
      .sort((a,b) => {
        const na = parseInt(a.numero,10), nb = parseInt(b.numero,10);
        if(!isNaN(na) && !isNaN(nb)) return na - nb;
        if(!isNaN(na)) return -1;
        if(!isNaN(nb)) return 1;
        return (a.nome||'').localeCompare(b.nome||'');
      });

    const wrap = document.getElementById('players');

    function playerCard(p){
      return `
        <div class="player">
          <img src="${p.foto}" alt="${p.nome}">
          <div>
            <div class="row">
              <span class="pill">#${p.numero || 'â€”'}</span>
              <strong>${p.nome}</strong>
            </div>
            <div class="small">${p.ruolo}</div>
          </div>
        </div>`;
    }

    function render(){
      const q = (document.getElementById('q').value || '').toLowerCase();
      const role = document.querySelector('#roles .chip.active')?.dataset.role || '';

      const rows = roster.filter(p => {
        const txt = `${p.nome} ${p.numero} ${p.ruolo}`.toLowerCase();
        const matchQ = txt.includes(q);
        const matchR = role === '' || (p.ruolo || '').toLowerCase().includes(role.toLowerCase());
        return matchQ && matchR;
      });

      wrap.innerHTML = rows.length
        ? rows.map(playerCard).join('')
        : '<div class="card">Nessun giocatore</div>';
    }

    // Eventi filtri/ricerca
    document.getElementById('q').addEventListener('input', render);
    document.querySelectorAll('#roles .chip').forEach(chip => {
      chip.addEventListener('click', () => {
        chip.parentElement.querySelectorAll('.chip').forEach(x => x.classList.remove('active'));
        chip.classList.add('active');
        render();
      });
    });

    // Primo render
    render();

    // PWA
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js');
    }
  </script>
  <script src="./ui.js"></script>
</body>
</html>
